---
title: "ggplot2の辞書"
author: "やわらかクジラ"
date: "`r format(Sys.time(), '%Y/%m/%d')`"
output: 
  html_document: 
    toc: TRUE
    toc_float: true
    toc_depth: 4
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```


# 辞書作成進捗

* 初期状態: 16チャンク(内非グラフ部分2チャンク)  
* 完了/追加予定  **13/`r 43+14*2`**チャンク  
  + 追加予定数は2020/07/03 現在



# 散布図(1): 2変数のみ
## デフォルトの図

* R for Data Scienceにならって、mpgデータを使用  
  + https://r4ds.had.co.nz/data-visualisation.html#first-steps  
* mpgデータ  
  + 車の人気モデル38種類における燃料効率データ（1999-2008年）
* 使用変数の説明
  + `displ`: エンジンの排気量（リットル）  
  + `hwy`:   燃料効率（miles per gallon[mpg]）

```{r}
library(tidyverse)
```

```{r}
p <- 
ggplot(mpg, aes(x = displ, y = hwy))

p + geom_point() 
```

## 点の書式
### 色
```{r}
p +
  geom_point(color = "deepskyblue3") 
```

### 大きさ


```{r}
p +
  geom_point(size = 3) 
```

### 濃さ（透明度）
```{r}
p +
  geom_point(alpha = 0.1) 
```



## タイトルと軸: labs()
### タイトル
```{r}
p +
  geom_point() +
  labs(
    title = "タイトル",
    subtitle = "サブタイトル",
    caption = "キャプション(短い説明文）"
       )
```

#### タイトルの文字サイズ変更
```{r}
p +
  geom_point() +
  labs(
    title = "タイトル",
    subtitle = "サブタイトル",
    caption = "キャプション(短い説明文）"
       ) +
  theme(
    plot.title    = element_text(size = 30),
    plot.subtitle = element_text(size = 20),
    plot.caption  = element_text(size = 15)
  )
```

#### タイトルの位置変更
```{r}
p +
  geom_point() +
  labs(
    title = "タイトル",
    subtitle = "サブタイトル",
    caption = "キャプション(短い説明文）"
       ) +
  theme(
    plot.title    = element_text(hjust = 0.5),   # 水平方向0-1の範囲で相対的な位置を指定
    plot.subtitle    = element_text(hjust = 0.5),
    plot.caption  = element_text(hjust = 0)
  )
```


### 軸の名前
```{r}
p +
  geom_point() +
  labs(
    x = "x軸の名前",
    y = "y軸の名前"
       )
```


## 軸の数値範囲: scale_continuous()  
### 数値範囲確認
```{r}
mpg %>% 
  select(displ, hwy) %>% # displとhwyを選んでsummary()に渡す
  summary()
```

### 範囲を指定して１ずつ増やす

* 数値型の場合は、`scale_x_continuous()`および`scale_y_continuous()`のbreaksで指定
* 表示範囲を強制指定する場合は`limits =` 

```{r}
p +
  geom_point() +
  scale_x_continuous(
    breaks = seq(from = 1, to = 8, by = 1), # 1から8まで1ずつ増える
    limits = c(1, 8)) +                     # 1を表示したい場合
  scale_y_continuous(
    breaks = seq(from = 10, to = 45, by = 5), # 10から45まで5ずつ増える
    limits = c(10, 45))
```


#### 手動で指定
```{r}
p +
  geom_point() +
  scale_y_continuous(
    breaks = c(15, 30, 45))       
```

## 軸の数値のサイズ
```{r}
p +
  geom_point() +
  theme(axis.text = element_text(size = 9)) # 単位はpt

p + 
  geom_point() +
  theme(axis.text = element_text(size = 12)) # 単位はpt

p +
  geom_point() +
  theme(axis.text = element_text(size = 16)) # 単位はpt

```


## グラフ中に線やテキストを追加
### 横線: geom_hline()
```{r}
p + 
  geom_point() +
  geom_hline(yintercept = 30,     # 座標の位置
             linetype = "dotted", # 点線
             color = "red",       # 色
             size = 1)            # 大きさ

```

### 縦線:geom_vline()
```{r}
p +
  geom_point() +
  geom_vline(xintercept = 5,
             linetype = "dotted",
             color = "red",
             size = 1)

```

### テキスト: annotate()
```{r}
p +
  geom_point() +
  annotate(geom = "text",
           x = 5, y = 35,  # テキストの中心座標位置
           label = "ここにテキスト",
           color = "blue",
           size = 10)
```

#### 相関係数を入れる


```{r}
# 相関係数の計算
corc <- 
  cor(mpg$displ, mpg$hwy) %>% 
  round(2)
 
p +
  geom_point() +
  annotate("text",
           label = str_c("r = ", corc), # 相関係数の代入 
           x = 6, y = 40,
           size = 6)
  
```



## 背景の色や線のテンプレート変更 

```{r}
p + 
  geom_point() +
  theme_bw()
```

```{r}
p +
  geom_point() +
  theme_classic()
```

# 散布図(2):3変数以上
## 色分け

* 使用変数の説明
  + `class`: 車種

```{r}
pc <- 
ggplot(mpg) +
  geom_point(aes(displ, hwy,
                 color = class))

pc 
```

### 色を手動で指定
```{r}
pc +
  scale_color_manual(values = c("red", "green", "blue", "yellow", "pink", "black", "brown"))
```


#### 凡例の名前変更
```{r}
pc +
  scale_color_manual(values = c("red", "green", "blue", "yellow", "pink", "black", "brown"),
                     labels = c("二人乗り","小型","中型","ミニバン","貨物","サブコンパクト","SUV"))
```


## 凡例の調整
### 凡例の位置
```{r}
pc +
 theme(legend.position = "bottom")

```

### 凡例を消す
```{r}
pc +
 theme(legend.position = "none")

```

### 凡例をグラフ中に

* `legend.position =` で、x軸、y軸のそれぞれを0-1の範囲で表した相対的な位置の座標で表す
* `legend.direction = "horizontal"`で、凡例を横向きに展開

```{r}
pc +
 theme(legend.position = c(.70, .80),
       legend.direction = "horizontal")

```

### 凡例の並べ方指定
```{r}
pc +
 theme(legend.position = "bottom") +
 guides(color = guide_legend(nrow = 1))  

```




## 変数の水準ごとにプロット: facet_wrap()
```{r}
pc +
  facet_wrap(vars(class))
```

### 並べ方指定

* 列数： ncol = 数字
* 行数： nrow = 数字

```{r}
pc +
  facet_wrap(vars(class),
             ncol = 2)
```
